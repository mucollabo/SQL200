-- 예제_179 SQL로 머신러닝 구현하기1(NAIVEBAYES) 


-- 1. 머신러닝 모델을 학습시킬 학습 데이터를 테이블로 생성합니다.  

DROP TABLE NAIVE_FLU_TRAIN;

CREATE TABLE NAIVE_FLU_TRAIN
( PATIENT_ID    NUMBER(10), 	
  CHILLS	VARCHAR2(2),
  RUNNY_NOSE	VARCHAR2(2),
  HEADACHE	VARCHAR2(10),
  FEVER  	VARCHAR2(2),
  FLU           VARCHAR2(2));

INSERT INTO NAIVE_FLU_TRAIN VALUES(1,'Y','N','MILD','Y','N');
INSERT INTO NAIVE_FLU_TRAIN VALUES(2,'Y','Y','NO'	,'N', 'Y');
INSERT INTO NAIVE_FLU_TRAIN VALUES(3,'Y','N','STRONG','Y','Y');
INSERT INTO NAIVE_FLU_TRAIN VALUES(4,'N','Y','MILD','Y','Y');
INSERT INTO NAIVE_FLU_TRAIN VALUES(5,'N','N','NO','N','N');
INSERT INTO NAIVE_FLU_TRAIN VALUES(6,'N','Y','STRONG','Y','Y');
INSERT INTO NAIVE_FLU_TRAIN VALUES(7,'N','Y','STRONG','N','N');
INSERT INTO NAIVE_FLU_TRAIN VALUES(8,'Y','Y','MILD','Y','Y');
COMMIT;

SELECT * FROM  NAIVE_FLU_TRAIN;

-- 2. 학습한 머신러닝 모델을 테스트할 테이블을 생성합니다.

DROP TABLE NAIVE_FLU_TEST;

CREATE TABLE NAIVE_FLU_TEST
( PATIENT_ID    NUMBER(10), 	
  CHILLS       VARCHAR2(2),
  RUNNY_NOSE  VARCHAR2(2),
  HEADACHE    VARCHAR2(10),
  FEVER        VARCHAR2(2),
  FLU          VARCHAR2(2));

INSERT INTO NAIVE_FLU_TEST VALUES(9,'Y','N','MILD','N', NULL);
COMMIT;

SELECT * FROM  NAIVE_FLU_TEST;

-- 3. 머신러닝 모델 환경설정 테이블을 생성합니다.

DROP TABLE SETTINGS_GLM;

CREATE TABLE SETTINGS_GLM
AS
SELECT *
   FROM TABLE (DBMS_DATA_MINING.GET_DEFAULT_SETTINGS)
   WHERE SETTING_NAME LIKE '%GLM%';

BEGIN
   INSERT INTO SETTINGS_GLM
        VALUES (DBMS_DATA_MINING.ALGO_NAME, 'ALGO_NAIVE_BAYES');

   INSERT INTO SETTINGS_GLM
        VALUES (DBMS_DATA_MINING.PREP_AUTO, 'ON');
   COMMIT;
END;
/


-- 4. 머신러닝 모델을 생성합니다. 

BEGIN
  DBMS_DATA_MINING.DROP_MODEL('MD_CLASSIFICATION_MODEL');
END;
/

BEGIN 
   DBMS_DATA_MINING.CREATE_MODEL(
      MODEL_NAME           => 'MD_CLASSIFICATION_MODEL',
      MINING_FUNCTION      => DBMS_DATA_MINING.CLASSIFICATION,
      DATA_TABLE_NAME       => 'NAIVE_FLU_TRAIN',
      CASE_ID_COLUMN_NAME   => 'PATIENT_ID',
      TARGET_COLUMN_NAME   => 'FLU',
      SETTINGS_TABLE_NAME   => 'SETTINGS_GLM');
END;
/


-- 5. 머신러닝 모델이 잘 생성되었는지 확인합니다. 

SELECT MODEL_NAME,
          ALGORITHM,
          MINING_FUNCTION
  FROM ALL_MINING_MODELS
  WHERE MODEL_NAME = 'MD_CLASSIFICATION_MODEL';

-- 6. 나이브 베이즈 머신러닝 모델이 테스트 데이터에 대해 예측한 값을 확인합니다. 

SELECT T.*,
  PREDICTION (MD_CLASSIFICATION_MODEL USING *) 예측값
  FROM NAIVE_FLU_TEST T;








  